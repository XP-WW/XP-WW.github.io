<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg"><link rel="icon" href="/img/avatar.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#fff"><meta name="author" content="è‹ç¦¾"><meta name="keywords" content="IT åšå®¢"><meta name="description" content="å¦‚ä½•åœ¨SpringBootä¸­é›†æˆSpringSecurityå’ŒJwtï¼Ÿ Jwtå¤§å®¶åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¤§å®¶å†™å®‰å…¨æ¡†æ¶åº”è¯¥ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯Jwtäº†ï¼Œè€ŒSpringSecurityå¤§å¤šæ•°æ˜¯å¤§é¡¹ç›®åœ¨ç”¨ç„¶åæœ€è¿‘æµ…å­¦äº†ä¸€ä¸‹SpringSecurity,ä½†æ˜¯ç½‘ä¸Šçš„æ•™ç¨‹å¤§å¤šæ•°çš„é›†æˆéƒ½æ˜¯è€ç‰ˆæœ¬ï¼Œå¯¹äºæ–°ç‰ˆæœ¬çš„é›†æˆæ¯”è¾ƒå°‘ï¼Œç„¶åè‡ªå·±ä¹Ÿæ˜¯ç¢ç£¨äº†å¾ˆä¹…ï¼Œçœ‹äº†ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œï¼Œç„¶åç°åœ¨æµ…æµ…è®°å½•ä¸€ä¸‹é›†æˆè¿‡ç¨‹å§ã€‚  å‰ç½®ç”¨æˆ·ç±»  12345"><meta property="og:type" content="article"><meta property="og:title" content="SpringBootä¸­é›†æˆSpringSecurityå’ŒJwt"><meta property="og:url" content="https://xp_ww.gitee.io/blog/619017079.html"><meta property="og:site_name" content="XP_WW"><meta property="og:description" content="å¦‚ä½•åœ¨SpringBootä¸­é›†æˆSpringSecurityå’ŒJwtï¼Ÿ Jwtå¤§å®¶åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¤§å®¶å†™å®‰å…¨æ¡†æ¶åº”è¯¥ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯Jwtäº†ï¼Œè€ŒSpringSecurityå¤§å¤šæ•°æ˜¯å¤§é¡¹ç›®åœ¨ç”¨ç„¶åæœ€è¿‘æµ…å­¦äº†ä¸€ä¸‹SpringSecurity,ä½†æ˜¯ç½‘ä¸Šçš„æ•™ç¨‹å¤§å¤šæ•°çš„é›†æˆéƒ½æ˜¯è€ç‰ˆæœ¬ï¼Œå¯¹äºæ–°ç‰ˆæœ¬çš„é›†æˆæ¯”è¾ƒå°‘ï¼Œç„¶åè‡ªå·±ä¹Ÿæ˜¯ç¢ç£¨äº†å¾ˆä¹…ï¼Œçœ‹äº†ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œï¼Œç„¶åç°åœ¨æµ…æµ…è®°å½•ä¸€ä¸‹é›†æˆè¿‡ç¨‹å§ã€‚  å‰ç½®ç”¨æˆ·ç±»  12345"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-09-30T12:32:24.000Z"><meta property="article:modified_time" content="2023-10-11T13:40:10.160Z"><meta property="article:author" content="è‹ç¦¾"><meta property="article:tag" content="SpringBoot"><meta property="article:tag" content="SpringSecurity"><meta property="article:tag" content="Jwt"><meta name="twitter:card" content="summary_large_image"><meta name="referrer" content="no-referrer-when-downgrade"><title>SpringBootä¸­é›†æˆSpringSecurityå’ŒJwt - XP_WW</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"xp_ww.gitee.io",root:"/",version:"1.9.5-a",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Blog of XP</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>é¦–é¡µ</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>å½’æ¡£</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>åˆ†ç±»</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>æ ‡ç­¾</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>å…³äº</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>å‹é“¾</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/bg/background.jpeg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,0)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="SpringBootä¸­é›†æˆSpringSecurityå’ŒJwt"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-09-30 20:32" pubdate>2023å¹´9æœˆ30æ—¥ æ™šä¸Š</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 9.2k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 77 åˆ†é’Ÿ </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span>æ¬¡</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">SpringBootä¸­é›†æˆSpringSecurityå’ŒJwt</h1><p class="note note-primary">æœ¬æ–‡æœ€åæ›´æ–°äºï¼š3 å°æ—¶å‰</p><div class="markdown-body"><h3 id="å¦‚ä½•åœ¨SpringBootä¸­é›†æˆSpringSecurityå’ŒJwtï¼Ÿ"><a href="#å¦‚ä½•åœ¨SpringBootä¸­é›†æˆSpringSecurityå’ŒJwtï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨SpringBootä¸­é›†æˆSpringSecurityå’ŒJwtï¼Ÿ"></a>å¦‚ä½•åœ¨SpringBootä¸­é›†æˆSpringSecurityå’ŒJwtï¼Ÿ</h3><blockquote><p>Jwtå¤§å®¶åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¤§å®¶å†™å®‰å…¨æ¡†æ¶åº”è¯¥ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯Jwtäº†ï¼Œè€ŒSpringSecurityå¤§å¤šæ•°æ˜¯å¤§é¡¹ç›®åœ¨ç”¨ç„¶åæœ€è¿‘æµ…å­¦äº†ä¸€ä¸‹SpringSecurity,ä½†æ˜¯ç½‘ä¸Šçš„æ•™ç¨‹å¤§å¤šæ•°çš„é›†æˆéƒ½æ˜¯è€ç‰ˆæœ¬ï¼Œå¯¹äºæ–°ç‰ˆæœ¬çš„é›†æˆæ¯”è¾ƒå°‘ï¼Œç„¶åè‡ªå·±ä¹Ÿæ˜¯ç¢ç£¨äº†å¾ˆä¹…ï¼Œçœ‹äº†ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œï¼Œç„¶åç°åœ¨æµ…æµ…è®°å½•ä¸€ä¸‹é›†æˆè¿‡ç¨‹å§ã€‚</p></blockquote><p class="note note-primary">å‰ç½®ç”¨æˆ·ç±»</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@EqualsAndHashCode(callSuper = false)</span><br><span class="hljs-meta">@Accessors(chain = true)</span><br><span class="hljs-meta">@TableName(&quot;user_info&quot;)</span><br><span class="hljs-meta">@Alias(&quot;UserInfo&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<span class="hljs-comment">//åºåˆ—åŒ–</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br>    <br>    <span class="hljs-meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String email;<span class="hljs-comment">//é‚®ç®±</span><br>    <span class="hljs-keyword">private</span> String password;<span class="hljs-comment">//å¯†ç </span><br>    <span class="hljs-keyword">private</span> String nickName;<span class="hljs-comment">//æ˜µç§°</span><br>    <span class="hljs-keyword">private</span> String realName;<span class="hljs-comment">//çœŸå®å§“å</span><br>    <span class="hljs-keyword">private</span> String phone;<span class="hljs-comment">//ç”µè¯</span><br>    <span class="hljs-keyword">private</span> String sex;<span class="hljs-comment">//æ€§åˆ«</span><br>    <span class="hljs-keyword">private</span> String avatar;<span class="hljs-comment">// å¤´åƒ</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¸€-å¼•å…¥ä¾èµ–"><a href="#ä¸€-å¼•å…¥ä¾èµ–" class="headerlink" title="ä¸€.å¼•å…¥ä¾èµ–"></a><p class="note note-info">ä¸€.å¼•å…¥ä¾èµ–</p><p></p></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--SpringSecurityä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ç‰ˆæœ¬è‡ªé€‰ï¼Œæˆ–è€…çˆ¶é¡¹ç›®ç‰ˆæœ¬ï¼Œæœ¬æ–‡ç”¨çš„3.1.3--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--Jwtä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="äºŒ-Jwtå·¥å…·ç±»"><a href="#äºŒ-Jwtå·¥å…·ç±»" class="headerlink" title="äºŒ.Jwtå·¥å…·ç±»"></a><p class="note note-info">äºŒ.Jwtå·¥å…·ç±»</p><p></p></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtUtils</span> &#123;<br>    <span class="hljs-comment">//ç®—æ³•å¯†é’¥</span><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.secretKey&#125;&quot;)</span><span class="hljs-comment">//åœ¨application.ymlæ–‡ä»¶é‡Œå†™ï¼Œç„¶åæ³¨å…¥</span><br>    <span class="hljs-keyword">private</span> String jwtSecretKey;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">(String userInfo, List&lt;String&gt; authList)</span> &#123;<br>        <span class="hljs-comment">//åˆ›å»ºæ—¶é—´</span><br>        <span class="hljs-type">Date</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        <span class="hljs-comment">//è®¾ç½®è¿‡æœŸæ—¶é—´</span><br>        <span class="hljs-type">Date</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(currentTime.getTime() + (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> *  <span class="hljs-number">60</span> * <span class="hljs-number">24</span>));<br>        <span class="hljs-comment">//jwt çš„headerä¿¡æ¯</span><br>        Map&lt;String, Object&gt; headerClaims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        headerClaims.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;JWT&quot;</span>);<br>        headerClaims.put(<span class="hljs-string">&quot;alg&quot;</span>, <span class="hljs-string">&quot;HS256&quot;</span>);<span class="hljs-comment">//åŠ å¯†ç®—æ³•</span><br>        <span class="hljs-comment">//åˆ›å»ºjwt</span><br>        <span class="hljs-keyword">return</span> JWT.create()<br>                .withHeader(headerClaims) <span class="hljs-comment">// å¤´éƒ¨</span><br>                .withIssuedAt(currentTime) <span class="hljs-comment">//å·²æ³¨å†Œå£°æ˜ï¼šç­¾å‘æ—¥æœŸï¼Œå‘è¡Œæ—¥æœŸ</span><br>                .withExpiresAt(expireTime) <span class="hljs-comment">//å·²æ³¨å†Œå£°æ˜ è¿‡æœŸæ—¶é—´</span><br>                .withIssuer(<span class="hljs-string">&quot;xp&quot;</span>)  <span class="hljs-comment">//å·²æ³¨å†Œå£°æ˜ï¼Œç­¾å‘äºº</span><br>                .withClaim(<span class="hljs-string">&quot;userInfo&quot;</span>, userInfo) <span class="hljs-comment">//ç§æœ‰å£°æ˜ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰</span><br>                .withClaim(<span class="hljs-string">&quot;auth&quot;</span>, authList) <span class="hljs-comment">//ç§æœ‰å£°æ˜ï¼Œå¯ä»¥è‡ªå®šä¹‰</span><br>                .sign(Algorithm.HMAC256(jwtSecretKey)); <span class="hljs-comment">// ç­¾åï¼Œä½¿ç”¨HS256ç®—æ³•ç­¾åï¼Œå¹¶ä½¿ç”¨å¯†é’¥</span><br>        <span class="hljs-comment">//HS256æ˜¯ä¸€ç§å¯¹ç§°ç®—æ³•ï¼Œè¿™æ„å‘³ç€åªæœ‰ä¸€ä¸ªå¯†é’¥ï¼Œåœ¨åŒæ–¹ä¹‹é—´å…±äº«ã€‚ ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ç”Ÿæˆç­¾åå¹¶å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚ åº”ç‰¹åˆ«æ³¨æ„é’¥åŒ™æ˜¯å¦ä¿å¯†ã€‚</span><br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éªŒè¯jwtçš„ç­¾åï¼Œç®€ç§°éªŒç­¾</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token éœ€è¦éªŒç­¾çš„jwt</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> éªŒç­¾ç»“æœ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verifyToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-comment">//è·å–éªŒç­¾ç±»å¯¹è±¡</span><br>        <span class="hljs-type">JWTVerifier</span> <span class="hljs-variable">jwtVerifier</span> <span class="hljs-operator">=</span> JWT.require(Algorithm.HMAC256(jwtSecretKey)).build();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//éªŒç­¾ï¼Œå¦‚æœä¸æŠ¥é”™ï¼Œåˆ™è¯´æ˜jwtæ˜¯åˆæ³•çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿‡æœŸ</span><br>            <span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">decodedJWT</span> <span class="hljs-operator">=</span> jwtVerifier.verify(token);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (JWTVerificationException e) &#123;<br>            <span class="hljs-comment">//å¦‚æœæŠ¥é”™è¯´æ˜jwt ä¸ºéæ³•çš„ï¼Œæˆ–è€…å·²è¿‡æœŸï¼ˆå·²è¿‡æœŸä¹Ÿå±äºéæ³•çš„ï¼‰</span><br>            log.error(<span class="hljs-string">&quot;éªŒç­¾å¤±è´¥ï¼š&#123;&#125;&quot;</span>, token);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//æ ¹æ®tokenè·å–ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-keyword">public</span>  String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String token)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">// ä½¿ç”¨ç§˜é’¥åˆ›å»ºä¸€ä¸ªè§£æå¯¹è±¡</span><br>            JWTVerifier jwtVerifier=JWT.require(Algorithm.HMAC256(jwtSecretKey)).build();<br>            <span class="hljs-comment">//éªŒè¯JWT</span><br>            <span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">decodedJWT</span> <span class="hljs-operator">=</span> jwtVerifier.verify(token);<br>            <span class="hljs-type">Claim</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> decodedJWT.getClaim(<span class="hljs-string">&quot;userInfo&quot;</span>);<span class="hljs-comment">//æ³¨æ„å¯¹è±¡è¦åºåˆ—åŒ–</span><br>            <span class="hljs-keyword">return</span> username.asString();<br>        &#125;<span class="hljs-keyword">catch</span> (TokenExpiredException e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>ã€<br>    <span class="hljs-comment">//é€šè¿‡tokenè·å–ç”¨æˆ·æƒé™åˆ—è¡¨</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getAuth</span><span class="hljs-params">(String token)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">// ä½¿ç”¨ç§˜é’¥åˆ›å»ºä¸€ä¸ªè§£æå¯¹è±¡</span><br>            JWTVerifier jwtVerifier=JWT.require(Algorithm.HMAC256(jwtSecretKey)).build();<br>            <span class="hljs-comment">//éªŒè¯JWT</span><br>            <span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">decodedJWT</span> <span class="hljs-operator">=</span> jwtVerifier.verify(token);<br>            <span class="hljs-type">Claim</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> decodedJWT.getClaim(<span class="hljs-string">&quot;auth&quot;</span>);<br>            <span class="hljs-keyword">return</span> auth.asList(String.class);<br>        &#125;<span class="hljs-keyword">catch</span> (TokenExpiredException e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ä¸‰-æ–°å»ºå®‰å…¨ç”¨æˆ·ç±»SecurityUser"><a href="#ä¸‰-æ–°å»ºå®‰å…¨ç”¨æˆ·ç±»SecurityUser" class="headerlink" title="ä¸‰.æ–°å»ºå®‰å…¨ç”¨æˆ·ç±»SecurityUser"></a><p class="note note-info">ä¸‰.æ–°å»ºå®‰å…¨ç”¨æˆ·ç±»SecurityUser</p><p></p></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetails</span> &#123;<span class="hljs-comment">//SpringSecurityæä¾›çš„æ¥å£</span><br>    <span class="hljs-comment">//æ ¸å¿ƒå°±æ˜¯å®ç°UserDeatilsæ¥å£ï¼Œç™»å½•çš„å¯¹è±¡å­˜åœ¨è¿™ä¸ªç±»é‡Œé¢</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserInfo userInfo;<br>    <br>    <span class="hljs-keyword">private</span> List&lt;SimpleGrantedAuthority&gt; simpleGrantedAuthorities;<br>    <br>    <span class="hljs-comment">//ä¼ å…¥ä¸€ä¸ªç³»ç»Ÿåº”ç”¨å¯¹è±¡æ„é€ SecurityUser</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecurityUser</span><span class="hljs-params">(UserInfo userInfo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userInfo = userInfo;<br>    &#125;<br><br>	<span class="hljs-comment">//å¦‚æœè®¾ç½®äº†æƒé™å°±åœ¨æ­¤å®ç°ç»™SecurityUserèµ‹äºˆæƒé™ä¸šåŠ¡</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        String userPassword=<span class="hljs-built_in">this</span>.userInfo.getPassword();<br>        <span class="hljs-comment">//æ³¨æ„æ¸…é™¤å¯†ç ï¼Œå› ä¸ºä¸æƒ³è¿”å›æ•°æ®æ—¶è®©å‰ç«¯çŸ¥é“ï¼Œåªèƒ½ç”±åç«¯éªŒè¯</span><br>        <span class="hljs-built_in">this</span>.userInfo.setPassword(<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">return</span> userPassword;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.userInfo.getEmail();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonLocked</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCredentialsNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEnabled</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å››-å°†ç”¨æˆ·Serviceå®ç°ç±»å®ç°UserDetailsService"><a href="#å››-å°†ç”¨æˆ·Serviceå®ç°ç±»å®ç°UserDetailsService" class="headerlink" title="å››.å°†ç”¨æˆ·Serviceå®ç°ç±»å®ç°UserDetailsService"></a><p class="note note-info">å››.å°†ç”¨æˆ·Serviceå®ç°ç±»å®ç°UserDetailsService</p><p></p></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfoServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserInfoMapper, UserInfo&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserInfoService</span>, UserDetailsService &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserInfoMapper userInfoMapper;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String email)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException&#123;<br>        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> userInfoMapper.selectByEmail(email);<br>        <span class="hljs-keyword">if</span> (userInfo == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;è´¦å·ä¸å­˜åœ¨&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityUser</span>(userInfo);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="äº”-å®ç°Jwtè¿‡æ»¤å™¨ç±»ï¼Œç”¨äºæ£€æŸ¥token"><a href="#äº”-å®ç°Jwtè¿‡æ»¤å™¨ç±»ï¼Œç”¨äºæ£€æŸ¥token" class="headerlink" title="äº”.å®ç°Jwtè¿‡æ»¤å™¨ç±»ï¼Œç”¨äºæ£€æŸ¥token"></a><p class="note note-info">äº”.å®ç°Jwtè¿‡æ»¤å™¨ç±»ï¼Œç”¨äºæ£€æŸ¥token</p><p></p></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtCheckFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> JwtUtils jwtUtils;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">//è·å–è¯·æ±‚uri</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        <span class="hljs-comment">// å¦‚æœæ˜¯ç™»å½•é¡µé¢ï¼Œæ”¾è¡Œ</span><br>        <span class="hljs-keyword">if</span> (requestURI.equals(<span class="hljs-string">&quot;/login&quot;</span>)) &#123;<br>            filterChain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//è·å–è¯·æ±‚å¤´ä¸­çš„Authorization</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">authorization</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;Authorization&quot;</span>);<br>        <span class="hljs-comment">//å¦‚æœAuthorizationä¸ºç©ºï¼Œé‚£ä¹ˆä¸å…è®¸ç”¨æˆ·è®¿é—®ï¼Œç›´æ¥è¿”å›</span><br>        <span class="hljs-keyword">if</span> (!StringUtils.hasText(authorization)) &#123;<br>            printFront(response,<span class="hljs-string">&quot;æœªç™»å½•&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//Authorization å»æ‰å¤´éƒ¨çš„Bearer ä¿¡æ¯ï¼Œè·å–tokenå€¼</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">jwtToken</span> <span class="hljs-operator">=</span> authorization.replace(<span class="hljs-string">&quot;Bearer &quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-comment">//éªŒç­¾</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">verifyTokenResult</span> <span class="hljs-operator">=</span> jwtUtils.verifyToken(jwtToken);<br>        <span class="hljs-comment">//éªŒç­¾ä¸æˆåŠŸ</span><br>        <span class="hljs-keyword">if</span> (!verifyTokenResult) &#123;<br>            printFront(response,<span class="hljs-string">&quot;jwtToken å·²è¿‡æœŸ&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//ä»payloadä¸­è·å–userInfo</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> jwtUtils.getUserInfo(jwtToken);<br>        <span class="hljs-comment">//ä»payloadä¸­è·å–æˆæƒåˆ—è¡¨</span><br>        List&lt;String&gt; userAuth = jwtUtils.getAuth(jwtToken);<br>        <span class="hljs-comment">//åˆ›å»ºç™»å½•ç”¨æˆ·</span><br>        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> objectMapper.readValue(userInfo, UserInfo.class);<br>        <span class="hljs-type">SecurityUser</span> <span class="hljs-variable">securityUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityUser</span>(user);<br>        <span class="hljs-comment">//è®¾ç½®æƒé™</span><br>        <span class="hljs-comment">//List&lt;SimpleGrantedAuthority&gt; authList = userAuth.stream().map(SimpleGrantedAuthority::new).collect(Collectors.toList());</span><br>        <span class="hljs-comment">//securityUser.setSimpleGrantedAuthorities(authList);</span><br>        <span class="hljs-type">UsernamePasswordAuthenticationToken</span> <span class="hljs-variable">usernamePasswordAuthenticationToke</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordAuthenticationToken</span>(securityUser<br>                , <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">//é€šè¿‡å®‰å…¨ä¸Šä¸‹æ–‡è®¾ç½®è®¤è¯ä¿¡æ¯</span><br>        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToke);<br>        <span class="hljs-comment">//ç»§ç»­è®¿é—®ç›¸åº”çš„urlç­‰</span><br>        filterChain.doFilter(request, response);<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printFront</span><span class="hljs-params">(HttpServletResponse response, String message)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        response.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);<br>        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();<br>        <span class="hljs-type">HttpResult</span> <span class="hljs-variable">httpResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpResult</span>();<br>        httpResult.setCode(<span class="hljs-number">500</span>);<br>        httpResult.setMessage(message);<br><br>        writer.print(objectMapper.writeValueAsString(httpResult));<br>        writer.flush();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å…­-æ–°å»ºSecurityé…ç½®ç±»"><a href="#å…­-æ–°å»ºSecurityé…ç½®ç±»" class="headerlink" title="å…­.æ–°å»ºSecurityé…ç½®ç±»"></a><p class="note note-info">å…­.æ–°å»ºSecurityé…ç½®ç±»</p><p></p></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-meta">@EnableMethodSecurity</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> JwtUtils jwtUtils;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> JwtCheckFilter jwtCheckFilter;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">securityFilterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        http.addFilterBefore(jwtCheckFilter, UsernamePasswordAuthenticationFilter.class);<br>        http.authorizeHttpRequests(auth -&gt; auth<br>                .anyRequest()<span class="hljs-comment">//æ‰€æœ‰è¯·æ±‚</span><br>                .authenticated()<span class="hljs-comment">//éƒ½éœ€è¦è®¤è¯</span><br>        );<br>        http.formLogin(form -&gt; form<br>                .permitAll()<span class="hljs-comment">//ç™»å½•æ¥å£æ”¾å¼€</span><br>                .successHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthenticationSuccessHandler</span>() &#123;<span class="hljs-comment">//è®¤è¯æˆåŠŸå¤„ç†å™¨</span><br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                        <span class="hljs-comment">//ä»è®¤è¯ä¿¡æ¯ä¸­è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</span><br>                        <span class="hljs-type">SecurityUser</span> <span class="hljs-variable">securityUser</span> <span class="hljs-operator">=</span> (SecurityUser) authentication.getPrincipal();<br>                        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> securityUser.getUserInfo();<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">strUserInfo</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(userInfo);<br><span class="hljs-comment">//                        List&lt;SimpleGrantedAuthority&gt; authorities = (List&lt;SimpleGrantedAuthority&gt;) securityUser.getAuthorities();</span><br><span class="hljs-comment">//                        List&lt;String&gt; authList = authorities.stream().map(SimpleGrantedAuthority::getAuthority).collect(Collectors.toList());</span><br><span class="hljs-comment">//                        //ç”ŸæˆJWT</span><br>                        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> jwtUtils.createToken(strUserInfo, <span class="hljs-literal">null</span>);<br>                        <span class="hljs-type">HttpResult</span> <span class="hljs-variable">httpResult</span> <span class="hljs-operator">=</span> HttpResult.builder().code(<span class="hljs-number">200</span>).message(<span class="hljs-string">&quot;jwtç”ŸæˆæˆåŠŸ&quot;</span>).data(<span class="hljs-string">&quot;Bearer &quot;</span>+token).build();<br>                        printToken(request,response,httpResult);<br>                    &#125;<br>                    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printToken</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,HttpResult httpResult)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(httpResult);<br>                        response.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>                        response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);<br>                        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();<br>                        writer.println(jwt);<br>                        writer.flush();<br>                    &#125;<br>                &#125;)<br>        );<br>        http.csrf(csrf-&gt;csrf.disable());<br>        <span class="hljs-keyword">return</span> http.build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå°±å¯ä¸ä½¿ç”¨å•¦ğŸ˜´ğŸ˜´ğŸ˜´ğŸ˜´</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Web%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" class="category-chain-item">Webåº”ç”¨å¼€å‘</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/SpringBoot/" class="print-no-link">#SpringBoot</a> <a href="/tags/SpringSecurity/" class="print-no-link">#SpringSecurity</a> <a href="/tags/Jwt/" class="print-no-link">#Jwt</a></div></div><div class="license-box my-3"><div class="license-title"><div>SpringBootä¸­é›†æˆSpringSecurityå’ŒJwt</div><div>https://xp_ww.gitee.io/blog/619017079.html</div></div><div class="license-meta"><div class="license-meta-item"><div>ä½œè€…</div><div>è‹ç¦¾</div></div><div class="license-meta-item license-meta-date"><div>å‘å¸ƒäº</div><div>2023å¹´9æœˆ30æ—¥</div></div><div class="license-meta-item"><div>è®¸å¯åè®®</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - ç½²å"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/blog/347607591.html" title="nginxç¼–è¯‘å®‰è£…"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">nginxç¼–è¯‘å®‰è£…</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/blog/3907716225.html" title="äºŒåˆ†æŸ¥æ‰¾"><span class="hidden-mobile">äºŒåˆ†æŸ¥æ‰¾</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="lv-container" data-id="city" data-uid="MTAyMC81OTAzMy8zNTQ5NQ== "><script type="text/javascript">Fluid.utils.loadComments("#lv-container",(function(){Fluid.utils.createScript("https://cdn-city.livere.com/js/embed.dist.js")}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>ç›®å½•</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="footer-inner"><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡ </span><span id="busuanzi_container_site_uv" style="display:none">æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div></noscript></body></html>