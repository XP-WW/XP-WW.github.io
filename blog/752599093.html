<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg"><link rel="icon" href="/img/avatar.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#fff"><meta name="author" content="苏禾"><meta name="keywords" content="IT 博客"><meta name="description" content="编写shell实现Nginx的编译安装及开机启动一：编写服务脚本实现Nginx服务管理（nginx.sh)#! &#x2F;bin&#x2F;bash #chkconfig: 35 85 15 DAEMON&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx case &quot;$1”in 	&quot;&quot;)  		echo &quot;Start nginx. . .&quot; 		$DAEMON &amp;&amp; echo &quot; Succes"><meta property="og:type" content="article"><meta property="og:title" content="nginx实验五"><meta property="og:url" content="https://xp_ww.gitee.io/blog/752599093.html"><meta property="og:site_name" content="XP_WW"><meta property="og:description" content="编写shell实现Nginx的编译安装及开机启动一：编写服务脚本实现Nginx服务管理（nginx.sh)#! &#x2F;bin&#x2F;bash #chkconfig: 35 85 15 DAEMON&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx case &quot;$1”in 	&quot;&quot;)  		echo &quot;Start nginx. . .&quot; 		$DAEMON &amp;&amp; echo &quot; Succes"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xp_ww.gitee.io/img/article_img/nginx.jpeg"><meta property="article:published_time" content="2023-10-15T12:57:42.000Z"><meta property="article:modified_time" content="2023-10-18T01:06:35.536Z"><meta property="article:author" content="苏禾"><meta property="article:tag" content="nginx"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://xp_ww.gitee.io/img/article_img/nginx.jpeg"><meta name="referrer" content="no-referrer-when-downgrade"><title>nginx实验五 - XP_WW</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"xp_ww.gitee.io",root:"/",version:"1.9.5-a",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Blog of XP</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/bg/background.jpeg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,0)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="nginx实验五"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-10-15 20:57" pubdate>2023年10月15日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.4k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 45 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span>次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">nginx实验五</h1><p class="note note-primary">本文最后更新于：2023年10月18日 上午</p><div class="markdown-body"><h3 id="编写shell实现Nginx的编译安装及开机启动"><a href="#编写shell实现Nginx的编译安装及开机启动" class="headerlink" title="编写shell实现Nginx的编译安装及开机启动"></a>编写shell实现Nginx的编译安装及开机启动</h3><h4 id="一：编写服务脚本实现Nginx服务管理（nginx-sh"><a href="#一：编写服务脚本实现Nginx服务管理（nginx-sh" class="headerlink" title="一：编写服务脚本实现Nginx服务管理（nginx.sh)"></a>一：编写服务脚本实现Nginx服务管理（nginx.sh)</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bash</span>
<span class="token comment">#chkconfig: 35 85 15</span>
<span class="token assign-left variable">DAEMON</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx
<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>”in
	"</span>"<span class="token punctuation">)</span> 
		<span class="token builtin class-name">echo</span> <span class="token string">"Start nginx. . ."</span>
		<span class="token variable">$DAEMON</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">" Success"</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	start<span class="token punctuation">)</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"Start nginx. . ."</span>
		<span class="token variable">$DAEMON</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"Success"</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	stop<span class="token punctuation">)</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"Stop nginx. . ."</span>
		<span class="token variable">$DAEMON</span> <span class="token parameter variable">-s</span> quit <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">" Success"</span> 
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	reload<span class="token punctuation">)</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"Reload nginx. .."</span>
		<span class="token variable">$DAEMON</span> <span class="token parameter variable">-s</span> reload <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">" Success"</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	restart<span class="token punctuation">)</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"Restart nginx. . ."</span>
		<span class="token variable">$DAEMON</span> <span class="token parameter variable">-s</span> quit
		<span class="token variable">$DAEMON</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">" Success"</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	*<span class="token punctuation">)</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"service nginx start or stop or restart or reload"</span>
		<span class="token builtin class-name">exit</span> <span class="token number">2</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（2）编写脚本实现Nginx的编译安装（install-nginx-sh）"><a href="#（2）编写脚本实现Nginx的编译安装（install-nginx-sh）" class="headerlink" title="（2）编写脚本实现Nginx的编译安装（install_nginx.sh）"></a>（2）编写脚本实现Nginx的编译安装（install_nginx.sh）</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bash</span>
<span class="token comment">#**************************************************************************************************</span>
<span class="token comment">#					Created by ZL on 2023.10.13                                                    *</span>
<span class="token comment"># nginx-1.10.3.tar.gz Centos-Base.repo epe1. repo nginx. sh ==> install_nginx.sh                  *</span>
<span class="token comment">#**************************************************************************************************</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span>	<span class="token operator">!</span>  <span class="token parameter variable">-f</span>  <span class="token string">"CentOS-Base.repo"</span> <span class="token parameter variable">-o</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token string">"epel.repo"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Without CentOs-Base.repo or epel.repo in current directory"</span> 
	<span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token keyword">else</span>
	<span class="token function">mkdir</span> /etc/ yum. repos.d/bak
	<span class="token function">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak
	<span class="token function">mv</span> *.repo /etc/yum.repos.d
<span class="token keyword">fi</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> pcre-devel openssl <span class="token parameter variable">-devel</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc gcc-c++
<span class="token keyword">if</span> <span class="token punctuation">[</span>	<span class="token operator">!</span>  <span class="token parameter variable">-f</span>  <span class="token string">"nginx-1.10.3.tar.gz"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Without Nginx installation package in current directory"</span>
	<span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token keyword">else</span>
	<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> nginx-1.10.3.tar.gz
	<span class="token builtin class-name">cd</span> nginx-1.10.3
	./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/nginx --with-http_ssl_module
	<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>

	<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
	<span class="token function">mv</span> nginx.sh /etc/init.d/nginx
	<span class="token function">chmod</span> +x /etc/init.d/nginx
	<span class="token function">chkconfig</span> <span class="token parameter variable">--add</span> nginx

	systemctl nginx start
	<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> nginx
	firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp <span class="token parameter variable">--permanent</span>
	systemctl restart firewalld
	<span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-r</span> nginx-1.10.3
	<span class="token function">rm</span> <span class="token parameter variable">-f</span> nginx-1.10.3.tar.gz
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（3）将nginx-1-10-3-tar-gz-CentOS-Base-repo-epel-repo-nginx-sh上传-root目录"><a href="#（3）将nginx-1-10-3-tar-gz-CentOS-Base-repo-epel-repo-nginx-sh上传-root目录" class="headerlink" title="（3）将nginx-1.10.3.tar.gz CentOS-Base.repo epel.repo  nginx.sh上传/root目录"></a>（3）将<code>nginx-1.10.3.tar.gz</code> <code>CentOS-Base.repo</code> <code>epel.repo</code> <code>nginx.sh</code>上传<code>/root</code>目录</h5><h5 id="（4）执行install-nginx-sh"><a href="#（4）执行install-nginx-sh" class="headerlink" title="（4）执行install_nginx.sh"></a>（4）执行install_nginx.sh</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#给install_nginx.sh加上可执行权限</span>
<span class="token function">chmod</span> +x install_nginx.sh
<span class="token comment">#运行</span>
./install_nginx.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="二：轮询负载均衡"><a href="#二：轮询负载均衡" class="headerlink" title="二：轮询负载均衡"></a>二：轮询负载均衡</h4><h5 id="（1-用命令设置好三台虚拟机的IP、子网掩码、网关和DNS1"><a href="#（1-用命令设置好三台虚拟机的IP、子网掩码、网关和DNS1" class="headerlink" title="（1)用命令设置好三台虚拟机的IP、子网掩码、网关和DNS1"></a>（1)用命令设置好三台虚拟机的IP、子网掩码、网关和DNS1</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#根据自己虚拟机实际情况来设置，下面仅作参考</span>
<span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-ens33

<span class="token comment">#第一台</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.37.4
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2

<span class="token comment">#第二台</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.37.5
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2

<span class="token comment">#第三台</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.37.6
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（2）按一步骤上传文件到三台服务器的-root目录，执行-install-nginx-sh编译安装Nginx"><a href="#（2）按一步骤上传文件到三台服务器的-root目录，执行-install-nginx-sh编译安装Nginx" class="headerlink" title="（2）按一步骤上传文件到三台服务器的&#x2F;root目录，执行./install_nginx.sh编译安装Nginx"></a>（2）按<code>一步骤</code>上传文件到三台服务器的&#x2F;root目录，执行<code>./install_nginx.sh</code>编译安装Nginx</h5><h5 id="（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。"><a href="#（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。" class="headerlink" title="（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。"></a>（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。</h5><h5 id="（4）修改192-168-66-4上的Nginx主配置文件，注释掉原有的server块，添加如下server块："><a href="#（4）修改192-168-66-4上的Nginx主配置文件，注释掉原有的server块，添加如下server块：" class="headerlink" title="（4）修改192.168.66.4上的Nginx主配置文件，注释掉原有的server块，添加如下server块："></a>（4）修改192.168.66.4上的Nginx主配置文件，注释掉原有的server块，添加如下server块：</h5><p><code>vim /usr/local/nginx/conf/nginx.conf</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.load-balance.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://web_server</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">#下面内容放在http模块里面而不是server里面</span>
<span class="token directive"><span class="token keyword">upstream</span> web_server</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.37.5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.37.6</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（5）在192-168-37-5添加包含如下内容的index-html的页面"><a href="#（5）在192-168-37-5添加包含如下内容的index-html的页面" class="headerlink" title="（5）在192.168.37.5添加包含如下内容的index.html的页面"></a>（5）在192.168.37.5添加包含如下内容的index.html的页面</h5><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome to 192.168.37.5! XuPan.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h5 id="（6）在192-168-37-6添加包含如下内容的index-html的页面"><a href="#（6）在192-168-37-6添加包含如下内容的index-html的页面" class="headerlink" title="（6）在192.168.37.6添加包含如下内容的index.html的页面"></a>（6）在192.168.37.6添加包含如下内容的index.html的页面</h5><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome to 192.168.37.6! XuPan.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h5 id="（7）修改hosts文件"><a href="#（7）修改hosts文件" class="headerlink" title="（7）修改hosts文件"></a>（7）修改hosts文件</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#修改C:\Windows\System32\drivers\etc下的hosts文件加入虚拟域名</span>
<span class="token number">192.168</span>.37.4 www.load-balance.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><h5 id="（8）用命令重新启动Nginx"><a href="#（8）用命令重新启动Nginx" class="headerlink" title="（8）用命令重新启动Nginx"></a>（8）用命令重新启动Nginx</h5><p><code>systemctl restart nginx</code></p><h5 id="（9）打开浏览器，输入www-load-balance-com后，多次刷新并观察"><a href="#（9）打开浏览器，输入www-load-balance-com后，多次刷新并观察" class="headerlink" title="（9）打开浏览器，输入www.load-balance.com后，多次刷新并观察"></a>（9）打开浏览器，输入<code>www.load-balance.com</code>后，多次刷新并观察</h5><p><code>若交替出现(5)(6)则表示轮询负载均衡配置成功</code></p><h4 id="三：加权轮询负载均衡"><a href="#三：加权轮询负载均衡" class="headerlink" title="三：加权轮询负载均衡"></a>三：加权轮询负载均衡</h4><h5 id="（1）在服务器192-168-37-4上，注释掉nginx-conf文件中原来的server块和upstream块，添加如下代码："><a href="#（1）在服务器192-168-37-4上，注释掉nginx-conf文件中原来的server块和upstream块，添加如下代码：" class="headerlink" title="（1）在服务器192.168.37.4上，注释掉nginx.conf文件中原来的server块和upstream块，添加如下代码："></a>（1）在服务器192.168.37.4上，注释掉nginx.conf文件中原来的server块和upstream块，添加如下代码：</h5><figure><div class="code-wrapper"><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.load-balance.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://web_server</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">#下面内容放在http模块里面而不是server里面</span>
<span class="token directive"><span class="token keyword">upstream</span> web_server</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.37.5 weight=1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.37.6 weight=2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>（2）用命令重新启动Nginx</p><p>（3）打开浏览器，输入<code>www.load-balance.com</code>后，多次刷新并观察。</p><p>（4）这种配置和轮询负载均衡的结果有何不同？</p><blockquote><p>weight&#x3D;2的虚拟机出现的机会更大，不再是轮询</p></blockquote><h4 id="四：永久缓存配置"><a href="#四：永久缓存配置" class="headerlink" title="四：永久缓存配置"></a>四：永久缓存配置</h4><h5 id="（1）用命令设置好两台台虚拟机的IP、子网掩码、网关和DNS1"><a href="#（1）用命令设置好两台台虚拟机的IP、子网掩码、网关和DNS1" class="headerlink" title="（1）用命令设置好两台台虚拟机的IP、子网掩码、网关和DNS1"></a>（1）用命令设置好两台台虚拟机的IP、子网掩码、网关和DNS1</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#根据自己虚拟机实际情况来设置，下面仅作参考</span>
<span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-ens33

<span class="token comment">#第一台</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.37.7
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2

<span class="token comment">#第二台</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.37.8
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.37.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（2）按一步骤上传文件到两台服务器的-root目录，执行-install-nginx-sh编译安装Nginx"><a href="#（2）按一步骤上传文件到两台服务器的-root目录，执行-install-nginx-sh编译安装Nginx" class="headerlink" title="（2）按一步骤上传文件到两台服务器的&#x2F;root目录，执行./install_nginx.sh编译安装Nginx"></a>（2）按<code>一步骤</code>上传文件到两台服务器的&#x2F;root目录，执行<code>./install_nginx.sh</code>编译安装Nginx</h5><h5 id="（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。-1"><a href="#（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。-1" class="headerlink" title="（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。"></a>（3）Windows浏览器上测试3台服务器，如果能够正常访问，继续，否则寻找原因。</h5><h5 id="（4）修改192-168-66-7上的Nginx主配置文件，注释掉原有的server块，添加如下server块。"><a href="#（4）修改192-168-66-7上的Nginx主配置文件，注释掉原有的server块，添加如下server块。" class="headerlink" title="（4）修改192.168.66.7上的Nginx主配置文件，注释掉原有的server块，添加如下server块。"></a>（4）修改192.168.66.7上的Nginx主配置文件，注释掉原有的server块，添加如下server块。</h5><p><code>vim /usr/local/nginx/conf/nginx.conf</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> 192.168.66.7</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
		<span class="token directive"><span class="token keyword">root</span> cache</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_store</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_store_access</span> user:rw group:rw all:rw</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_temp_path</span> cache_tmp</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.37.8</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（5）在nginx的安装目录创建cache目录"><a href="#（5）在nginx的安装目录创建cache目录" class="headerlink" title="（5）在nginx的安装目录创建cache目录"></a>（5）在nginx的安装目录创建cache目录</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#进入nginx的安装目录</span>
<span class="token builtin class-name">cd</span> /usr/local/nginx/
<span class="token comment">#创建cache目录</span>
<span class="token function">mkdir</span> cache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（6）用命令将cache目录的所有者改为nobody"><a href="#（6）用命令将cache目录的所有者改为nobody" class="headerlink" title="（6）用命令将cache目录的所有者改为nobody"></a>（6）用命令将cache目录的所有者改为nobody</h5><p><code>chown nobody cache</code></p><h5 id="（7）用命令赋予nobody对cache目录的读写权限"><a href="#（7）用命令赋予nobody对cache目录的读写权限" class="headerlink" title="（7）用命令赋予nobody对cache目录的读写权限"></a>（7）用命令赋予nobody对cache目录的读写权限</h5><p><code>chmod u+rw cache</code></p><h5 id="（8）用命令重新启动nginx"><a href="#（8）用命令重新启动nginx" class="headerlink" title="（8）用命令重新启动nginx"></a>（8）用命令重新启动nginx</h5><p><code>systemctl restart nginx</code></p><h5 id="（9）修改内容服务器（192-168-66-8）的index-html页面"><a href="#（9）修改内容服务器（192-168-66-8）的index-html页面" class="headerlink" title="（9）修改内容服务器（192.168.66.8）的index.html页面"></a>（9）修改内容服务器（192.168.66.8）的index.html页面</h5><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">&#123;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 35em<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nginx.png<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Xu Pan <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">></span></span>Thank you for using nginx cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>（10）在<code>192.168.66.8</code>的html目录建立2个文件夹，命名为test和test2，将index.html和nginx.png分别复制到test和test2</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#进入html目录</span>
<span class="token builtin class-name">cd</span> /usr/local/nginx/html
<span class="token comment">#创建test test2目录</span>
<span class="token function">mkdir</span> <span class="token builtin class-name">test</span> test2
<span class="token comment">#复制到test和test2</span>
<span class="token function">cp</span> index.html nginx.png <span class="token builtin class-name">test</span>
<span class="token function">cp</span> index.html nginx.png test2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h5 id="（11）在Windows的浏览器上输入"><a href="#（11）在Windows的浏览器上输入" class="headerlink" title="（11）在Windows的浏览器上输入"></a>（11）在Windows的浏览器上输入</h5><p><code>http://192.168.66.7/</code></p><p><code>http://192.168.66.7/test/index.html</code></p><p>访问成功后，再修改配置文件</p><figure><div class="code-wrapper"><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> 192.168.66.7</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
		<span class="token directive"><span class="token keyword">root</span> cache</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_store</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_store_access</span> user:rw group:rw all:rw</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_temp_path</span> cache_tmp</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">if</span> (!-e <span class="token variable">$request_filename</span>)</span> <span class="token punctuation">&#123;</span>
           <span class="token directive"><span class="token keyword">proxy_pass</span> http://192.168.37.8</span><span class="token punctuation">;</span> 
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>重启nginx</p><p><code>systemctl restart nginx</code></p><h5 id="（12）在Windows的浏览器上输入http-192-168-37-7-test2-index-html"><a href="#（12）在Windows的浏览器上输入http-192-168-37-7-test2-index-html" class="headerlink" title="（12）在Windows的浏览器上输入http://192.168.37.7/test2/index.html"></a>（12）在Windows的浏览器上输入<code>http://192.168.37.7/test2/index.html</code></h5><h5 id="（13）查看192-168-66-7的cache目录，若看到下面所示的结果，表示缓存配置成功。"><a href="#（13）查看192-168-66-7的cache目录，若看到下面所示的结果，表示缓存配置成功。" class="headerlink" title="（13）查看192.168.66.7的cache目录，若看到下面所示的结果，表示缓存配置成功。"></a>（13）查看192.168.66.7的cache目录，若看到下面所示的结果，表示缓存配置成功。</h5><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@xp-centos7e cache<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token builtin class-name">test</span>  test2
<span class="token punctuation">[</span>root@xp-centos7e cache<span class="token punctuation">]</span><span class="token comment"># cd test</span>
<span class="token punctuation">[</span>root@xp-centos7e test<span class="token punctuation">]</span><span class="token comment"># ls</span>
index.html  nginx.png
<span class="token punctuation">[</span>root@xp-centos7e test<span class="token punctuation">]</span><span class="token comment"># cd ..</span>
<span class="token punctuation">[</span>root@xp-centos7e cache<span class="token punctuation">]</span><span class="token comment"># cd test2</span>
<span class="token punctuation">[</span>root@xp-centos7e test2<span class="token punctuation">]</span><span class="token comment"># ls</span>
index.html  nginx.png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/nginx/" class="category-chain-item">nginx</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/nginx/" class="print-no-link">#nginx</a></div></div><div class="license-box my-3"><div class="license-title"><div>nginx实验五</div><div>https://xp_ww.gitee.io/blog/752599093.html</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>苏禾</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年10月15日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/blog/4126800539.html" title="Docker学习笔记"><span class="hidden-mobile">Docker学习笔记</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="footer-inner"><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>